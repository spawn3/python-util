\section{12}

\subsection{03}

手腕扭伤快好了。真是旷日持久，一点点小问题，竟然如此，不可不慎重。病向浅中医，养生须趁早。

最重要的是下一阶段的工作问题。内壮则外强，不论何时何地，不要心怀幻想。\hl{放弃幻想，准备战斗}是战士的必然选择。
枕戈待旦是为将者的核心素养。

学习中医、太极，一是道，二是术，道术并重，前期以道为主，明理，后期深入术中，以道卫术。
有所偏重，交相互养。从更大的视野去看，道一而术多，都可以看作道的应用，博观约取。

对学习计算机技术也有好处，相互发明，在交叉地带有所领悟。为学日益为道日损。

徐特立老读书学习之法，定量、有恒，不可自乱方寸。

\subsection{04}

以心行气，以气运身。气是沟通身心的桥梁，区分先天气和后天气，呼吸是后天气，内气、真气从之的是先天气。
随外在呼吸，引领先天气之循环：沿着任脉而沉至丹田，沿着督脉而上达百会，形成闭环。任督通，则成小周天。
吸升呼降，升级的圆运动。医理拳理通。只有丹田聚气养气充沛，自然能打通任督二脉。

活动关节，找到途径各关节的主要穴位进行按摩，以起到拉伸的效果。循经找穴，进而通过经络上的关键穴位进行按摩。

\subsection{05}

洪范五福：《尚书》上所记载的五福\hl{一曰寿、二曰富、三曰康宁、四曰攸好德、五曰考终命}，
东汉桓谭于《新论·辨惑第十三》把“考终命”更改，将五福改为“寿、富、贵、安乐、子孙众多”。
现代常把“五福临门”当作新春祝福使用。

六极：一曰凶、短、折, 二曰疾，三曰忧，四曰贫，五曰恶，六曰弱。

积贫积弱，富强的现代化中国。五福有可为有可为而不可期，如康宁、攸好德、富，一定程度上是可以做的。
这里有因果业力法则在起作用。

\begin{shadequote}
兴五福销六极

问：昔周著《九畴》之书，汉述《五行》之志，皆所以精究天人之际，穷探政化之源。然则五福之祥，何从而作；六极之沴，何故而生？
将欲辨行，可明本末。又今人财耗费，既贫且忧，时沴流行，或疾而夭。思欲销六极，致五福，殴一代于富寿，纳万人于康宁。何所施为，可致于此？

臣闻圣人兴五福销六极者，在乎\hl{立大中致大和}也。至哉中和之为德，不动而感，不劳而化，以之守则仁，以之用则神，卷之可以理一身，舒之可以济万物。
然则和者生于中也，中者生于不偏也，不邪也，不过也，不及也。若人君内非中勿思，外非中勿动，动静进退，皆得其中，故君得其中，则人得其所，人得其所，则和乐生焉。
是以君人之心和，则天地之气和，天地之气和，则万物之生和。于是乎三和之气，䜣合絪缊，积为寿，蓄为富，舒为康宁，敷为攸好德，益为考终命。
其羡者则融为甘露，凝为庆云，垂为德星，散为景风，流为醴泉。六气叶乎时，七曜顺乎轨，迨于巢穴羽毛之物，皆煦妪而自蕃，草木鳞介之祥，皆丛萃而继出。
夫然者，中和之气所致也。若人君内非中是思，外非中是动，动静进退，不得其中，故君不得其中，则人不得其所，人不得其所，则怨叹兴焉。
是以君人之心不和，则天地之气不和，天地之气不和，则万物之生不和。于是乎三不和之气，交错堙郁，伐为凶短折，攻为疾，聚为忧，损为贫，结为恶，耗为弱。
其羡者潜为伏阴，淫为愆阳，守为彗星，发为暴风，降为苦雨。四序失其节，三辰乱其行，迨乎襁褓卵胎之生，皆夭阏而不遂，木石华虫之怪，皆糅杂而毕呈。
夫然者，不中不和之气所致也。则天人交感之际，五福六极之来，岂不昭昭然哉。臣伏见比者兵赋未减，人鲜无忧，时沴所加，众或有疾。
德宗皇帝病人之病，忧人之忧，于是救之以广利之方，悦之以中和之乐，将使易忧为乐，变病为和，惠化之恩，莫斯甚也。

然臣窃闻善除害者察其本，善理疾者绝其源。伏惟陛下欲纾人之忧，先念忧之所自；欲救人之病，先思病之所由。知所自以绝之，则人忧自弭也；知所由以去之，则人病自瘳也。
然后申之以救疗之术，则人易康宁；鼓之以安乐之音，则人易和悦。斯必应疾而化速，利倍而功兼。六极待此而销，五福待此而作。
如是，可以陶三才缪滥之气，发为休祥；殴一代鄙夭之人，臻乎仁寿。中和之化，夫何远哉！
\end{shadequote}

东方治理学中阐述的黄帝四经基本方法论，作为基石。由此而展开为完整体系。理论核心在于体味阴阳中和的奥义。

撞丹田有上中下三个高度，每种高度20次为一组。完成5组为一轮。暂定如此，必须数量化。
\hl{任何活动都考虑量化}，包括标准和验收。按由轻到重的原则，逐步加大运动量到一最大值，然后保持，允许有一定波动。
度数信，即是围绕中心轴的圆周运动，弦动方式。务必重视周期和节律。

张三丰打坐歌需要背诵。

意气运动要贯彻到一切运动中，这就意味着尽量慢，体会其中意气运行的节律。
数量并非第一重要，重要的是内在质量。

\subsection{06}

\subsection{07}

本周基本理解了RDMA，下周需要继续，列出以学习计划。

修炼也渐渐进入状态，坚持的并不算好。还需要加大力度和决心，通过一定手段调理身心是一辈子要进行的工作，不能轻视。
核心理念就是通经络，调气血，致中和。这也是世界运行的方式。

张首晟去世事件令人震惊，跨界资本失败造成的？也发人深思，\hl{专业是立身之本}，下一步需要进一步深入去学习。
丹华资本是一步错棋？投资决策过于乐观？默默地做好自己的专业，再考虑趁势而起。不要给自己太大压力。\hl{从容中道乃最佳策略}。

\hl{太极混元桩站起}，静中有动，气息流动，一刻不停。

每次集中攻克一个问题，目前静坐中，发现一些痛点。按瓶颈理论去处理。

\subsection{10}

站桩，太极混元桩、三体桩。为什么说万法出自三体桩。从无极桩、混元桩练习开始。
有足够的时间慢慢练习、体悟其原理。

动静交养，静坐、站桩、内家拳，都需要\hl{调心、调息、调身}。一呼一吸为一息，呼吸于生命而言，极为重要。
此中反思，对今后若干年具有重要价值。生活习惯、对生命的理解在这个过程中得以深化。
静坐、站桩、丹田功这些基本的内功心法，需要坚持下去，\hl{循序渐进、持之以恒}。信解行证，度数信。
基本方法无它，就是围绕一中心点，日积月累，以达豁然贯通之境。

\hl{脏腑、经络都可以看作中医的象数模型}。取象比类，就是一种模型思维。
至于模型是否反映真实情况，需要在实践中进行调节。

HY下一步会很艰难，是否陪着走下去是一个重要的抉择。是否有利于今后长期发展？是否有大的突破？
当断不断，必受其乱。选择的最重要标准就是下一步的发展。平台、领导、行业都极其重要。

简化简化再简化，放弃幻想、准备战斗，机会主义要不得。

\subsection{11}

平时行坐站卧都要注意姿势，功夫要下在平时，用正确的理念塑造良好的生活习惯。这个才是细水长流之道。
功夫怎么才能上身？不是机械地去练习，而是全身心地投入，用心领悟其精义。

体育运动与专业学习一样，遵循相同原则，如循序、有恒。刻意练习的理念，怎么用起来？
专项训练，全面提升。如何设计一套切实可行的健身法？应该包括：
\begin{enumbox}
\item 站桩
\item 静坐
\item 八段锦
\item 太极
\end{enumbox}

一些小敲门：
\begin{enumbox}
\item 腹式呼吸
\item 撞丹田
\item 跪式
\item 刷牙
\item 扣齿
\item 梳头
\item 提肛
\end{enumbox}

禅坐先不求速效，每天盘盘腿，重点关注一些痛点，就会有进步。日拱一卒的精神。
每一种功法都需要大量的时间积累，才能见效果。一个时期最好只有一种重点项目，待步上正轨时，再开始下一项。
采取一主多辅的架构。比如本阶段一撞丹田为主，以站桩、静坐为辅等等。
最后把所有的功法九九归一，抱元归一，回到旋极图的象征。

老子四十二章是最高哲学。\hl{道生一、一生二、二生三、三生万物。万物负阴而抱阳，中气以为和}。
这几句话包含了终极真理。要从中出发，展开为现实的力量。

近期的沉淀期，有其价值，沉下来，再出发。收敛到中间一点，收放自如。潜龙勿用，阳在下也。复其见天地之心。
最重要是保养此一团阳气，以直养而无害，则塞乎天地之间。越养越精神，以做持久战。

悟中道之理，成炼金术士。炼金术士者，能化腐朽为神奇。河洛五行，中土最为贵，乃调理转化之器。

放弃吧，现在变成很大的负能量，就这样不明不白的，有什么意思？现在的主要精力，应放在下一步的健康发展上。
真是内忧外患，有陷在泥潭里的感觉，世界那么大，为什么不走出去看看？

可以了解很多，最重要的确实基本功。

\subsection{14}

书本知识往往已经过时，紧跟会议、论文、各公司的实践活动。

\subsection{17}

\hl{大动不如小动，小动不如不动，不动之动乃生生不已之动}。此语精妙，极有启发。让人回归本源，无为而无不为，故大成拳是无为法。
剔除枝叶，一意本源。

在技术上事业上都有很好的启迪。处当今之际，HY可谓内忧外患，风雨飘摇。更有追问本质，以图活下去。
在技术上，一切围绕ABC，又分主次。主为linux、ceph等。通其一，万事毕。

大成拳心法功法俱为上佳，可以为一段时间的探索画上一个句号了。医武同源，同臻于道。道零德一而万物化生。
信解行证是一循环，转动不已。进而，立禅即意，此中禅意，渐渐融入生活中，行住坐卧，无往不在禅意中。
则与道合一。往日学习，偏于知解，缺乏体证，遂茫茫然不知所归，没有受用处。

大成拳与阳明心学都在唤醒自然本具之良知良能，栽培涵养，心中分别心生，则离道日远，佛理深邃，不可思议。
水性太极，妙悟圆觉，大成立禅，归心金刚。都需用心体证，勿自限于文字知解，何况不能达于文字般若，
妄生议论，枉费口舌，大可不必。

至此，各方面均有妥当安排，可以心无旁骛，尽心驰骋了。艺宗AB，拳归大成。

不管HY如何，这次一定要走。初步定为xsky，离家距离不算太远，发展势头蒸蒸日上。
最重要的是，与手头做的最为接近，可以全力以赴投入技术的进一步深造。

也需要安排几个候选，如京东云、联想、首都在线。至此，对下一步的职业规划基本定位清晰。

\subsection{18}

想不到华云窘迫至此，真是可叹！

贪多嚼不烂，全闪是唯一机会。

放弃幻想，准备战斗。积极准备找工作，静观其变吧。损失云云，不作为主要考虑项。
永远往前看，修之于身，其德乃真。

全用户态SDS，就照着这个目标努力。把握好AFA这个风口。
怎么建立相关知识体系呢？

运用心的综合能力，不要被细枝末节所遮蔽。

\subsection{19}

\subsection{20}

数据为王，存储是关键，必须坚持深入，建立完整的知识体系，同时有一门深入的定力和决心。
致广大而尽精微。

领域
\begin{enumbox}
\item 操作系统
\item 数据结构和算法
\item C/C++
\item RDMA
\item DPDK/SPDK
\item NVMe
\item FusionStor/Ceph
\item 其它分布式存储系统 (FS and DB etc)
\end{enumbox}

现在是一个重要的发展阶段。静下心来，好好转动PDCA循环。

linux io path非常重要，direct io绕过page cache，故需要对齐。aio依赖于direct io，也需要对齐。

块设备驱动的分层架构：\hl{vfs，page cache，general block，scsi}，主机通过scsi协议连接到磁盘。
主机通过pcie的NVMe连接到NVMe SSD。

为什么1M块的读写如此慢？

latency和iops的关系：拿行驶在路上的车为例，没有饱和时，latency不受iops的影响；达到饱和后，如何维持稳定的iops就是一个大问题。
另外，故障对iops的影响也是设计上的大问题。故障后，进入降级运行状态，需要标记，以利恢复。\hl{论述并发和故障对iops的影响}。

\hl{理解异步操作}，异步操作不同于非阻塞操作，依赖于非阻塞操作。aio、NVMe、RDMA、DPDK都采用了异步通信机制。
提交任务到队列，在polling线程里处理完成事件：
\begin{enumbox}
\item 提交
\item 完成（事件驱动、或PMD, callback）
\item 保持上下文
\end{enumbox}

提交和完成可以在同一线程里。

在异步操作之上可以构建同步操作。如rpc，提交请求后，进入yield状态；完成请求后，resume。
用状态机、或协程实现，原理都一样。

\hl{线程+队列}是中异常强大的模型。

\begin{enumbox}
\item aio syscall与eventfd结合，可以纳入epool/pool/select机制之中。
\item NUMA/cpuset和hugepage
\item 增删节点（异步化）
\end{enumbox}

其它如timerfd，signalfd都可以纳入epool机制，提供事件等待和通知机制。

启动若干aio polling线程，提交或检查完成状态。在aio api之上，用poll作为事件通知机制。
用到了两个eventfd，一个用于提交请求的通知，一个用于检查完成状态。

线程加一控制对象，对象包括上下文信息、队列等。

sqlite操作采用了类似机制。

\subsection{21}

linux内核分析和应用、大规模分布式存储系统是两本好书，按此知识体系按图索骥，\hl{致广大而尽精微}。
但这里的主题不够全面、深刻，更新更深的主题和知识点通过微信公众号、论文、blog等加以补充。

把握行动学习两原则和刻意练习、PDCA、黄金圈发展等基本理念，来指导自己的学习过程。

怎么高效地利用资源？

NUMA架构的cpu资源如何利用？线程core binding，私有hugepage分配器。
上层网络连接等任务hash到不同的core thread里。在一个core thread里处理提交、完成检查等基本操作。
同步操作，如io、网络、数据库访问，派生独立的线程池去处理。
如何做到内存本地化？如何做到thread均匀地映射到NUMA节点上。

如何减少上下文切换和数据copy的开销。

可抽象出独立的内存分配器，每个core有一个内存分配器的实例。

从线程的角度看，分为事件循环线程和工作线程，通过队列把各个线程连接起来，actor and channel模式、csp模型。

分析烧开水这个过程。打开开关后，我就可以走开去处理别的事情。由电水壶独立处理烧开水这个事，等它处理完成后，会鸣笛通知。
我得到通知，就可以使用其中的开水了。如果有多个电水壶，它们就可以并行工作。（\hl{用UML序列图来描述}）

领导安排任务也遵循同样的逻辑。通过比类取象的方法去理解，并不难。

\hl{网中网}：主机与磁盘的连接，也可以看作是网络。如NVMe SSD，就是NVMe over PCIe，运行在PCIe上的NVMe。
普通的disk也是如此。PCIe采用串口技术，比并口更快是因为具有更高的频率。
从协议上看，NVMe对SCSI的优化体现在哪些地方？ NVMe标准依然在快速演进。

与网络连接不同的是，主机与设备的连接是本地的，不是远程跨主机的。

从架构上，本地存储引擎这部分代码应该是简单的。本地磁盘管理：
\begin{enumbox}
\item pool与disk具有一对多的映射关系
\item 每个盘是个状态机
\item 磁盘多态：支持normal and NVMe disks
\item 分配磁盘位置，首先选择盘，再选择盘上的某个位置
\item 检查磁盘故障，并修复数据
\item 引用计数技术
\end{enumbox}

每个盘有属性和方法，包括分配、读写。每个disk有独立的分配工作线程。
一次分配请求，大部分情况下，是一块盘去满足。如果一块盘空间不足，就需要多盘。
要能够表达非连续的离散空间。请求端是同步操作，用一个lock来实现。由工作线程unlock。wuw序列。

normal disks采用aio方式，NVMe才有自己的方式(kernel bypass)。

chunk位置映射，有cache，读多写少。数量大，cache采用LRU置换算法。
\hl{要充分理解各种各样cache的重要性。作为一个重要的主题去掌握}。

参考lich架构，用c++写一个分布式全闪产品，是一个重要的想法。
这样，既可以从设计者的角度去理解lich，也可以引入一些优化项。
最重要是精简，不是一日之功，需要持久战，长期专注思考和coding。
就是她了。

\subsection{22}

lich采用了epoll+aio的io模型，epoll+同步io会引起线程主循环的效率。可以从两个层面看这个模型，
堵塞在epool上，就绪时进一步引入aio。事件和实际的io操作。aio是通过工作线程和多个队列共同完成的。

transfer，tcp和rdma，是可以共存的，都可以理解为条条大路通罗马，信息高速公路。在c/s之间建立了一条虚拟通路。
这条通路是在第三个对象的辅助之下建立的，监听socket。监听socket和连接socket可以统一地在一个事件处理框架内去处理。
针对每个socket，有独立的处理过程。

自转、公转两个环，polling处就是中心所在。消息有自转，也围绕中心公转，是双环，两个层面的事情。

提交和完成是两个过程，可以放在两个独立的线程里，也可以合二为一，用一个独立线程去做。队列需要各自独立。
队列+线程是强大的编程模型。如SEDA架构所描述的，可以有很多的变体。可以用来实现异步操作。

中断指的是cpu处理的中断，有外部事件发生时触发，cpu收到后，进入中断处理程序。与进程调度一起来考量。
中断时理解问题的一个关键概念。线程与协程的主要不同就在于此。线程可抢占，协程不可抢占。进程进入wait态后，需要中断去唤醒。

\hl{等待事件的线程，被中断唤醒后，重新加入ready队列，可以被调度执行}。

进一步，要理解mmap和sendfile的工作机制和带来的好处，主要从syscall讲起，如何减少上下文切换和内存copy的成本。

取象比类的方法理解计算的世界。

多存储网段，有多个port互联，若做bond，就是合成一条。
异步操作，烧开水。性能指标，汽车在路上行驶。确实有生动形象、易于理解的效果。中医的经络、藏象，方法上是相通的。
这是费曼提倡的方法。操作系统里的关键问题和技术，都是通过故事的形式引入的，如生产者消费者，哲学家就餐，背包等。

这比一味地在api之间晕头转向要好得多，并不是说api不需要掌握，而是明理后api的设计就是自热而然的过程。
这样设计出来的api自然贴切，持久稳定。

用解剖麻雀的方式解剖lich，认识其亮点和不足之处。在与ceph对比的过程中，进行创造性综合，集大成。

本周通过分析异步操作，终于有了贯通感，网络编程，包括TCP和RDMA、NVMe、iSER等，都采用了相似的设计模式。
深入理解进程、线程和协程，加上对队列的理解，就可以理解大部分问题了。

进而理解lua、erlang、go的协程模型。

道法术器，器是产品、系统，术是实现技术，法是架构和算法，道是原理。明理、善学，在术的层面要多进行刻意练习。

渐渐觉得，单纯看书不是学习的最佳方法。看书是第二位的事情，第一位的是在头脑里进行的综合分析和判断，就是用意不用力。
比如学习网络编程，大部分的书籍，都是在展现一个知识体系，至于最佳实践，往往显得过时而且没有针对性。

边想边做边读书，效果会更好。一直以来，有过于偏重读书的习惯，反而迷失了宗旨大义所在。
每本书，在知识的程序上，有重点和等级的不同。如linux环境编程更多讲一个一个api，以及api在linux kernel的实现方式。
这一层面是深入的知识，但从应用的角度去看，却远远不够直接。

道法更多是理念层面的，术器是实物层面，术是建筑系统这一大厦的一砖一瓦。道法则是指导建筑的原理和方法。

\subsection{23}
