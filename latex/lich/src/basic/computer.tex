\chapter{计算机体系结构}

组成原理与体系结构，研究内容相当。

\section{结构}

三部分：CPU，存储器，I/O设备。PCIe和NUMA都采用分布式架构，PCIe是串行点对点，
NUMA分远和近，访问远程CPU慢。可以称为分布式共享内存。

二进制

进制之间的转换
\begin{enumbox}
\item 整数（除2取余）
\item 负数（取反加1）
\item 小数（乘2取整）
\item 浮点数采用科学计数法，分单精度与双精度
\item 高位是符号位
\item 表示范围不变，坐标平移
\end{enumbox}

字节顺序：32bit机器上字长是4B，64bit机器上字长是8B。
一个字的字节采用由左到右编码，或从右到左编码。
big-endian表示尾端在高位，little-endian表示尾端在低位。

\section{执行}

一颗CPU的执行可以看着一维的指令流，由顺序和跳转指令，由调度程序模拟多任务的假象。
并发执行需要进行同步，以避免引起的问题，保证数据的一致性和安全性、执行结果的准确性。

基于lock的同步，可能会引起死锁或饥饿现象，须加以避免、检测。

进程的五状态模型，进程调度算法

流水线并行示意图

协同过程，又称协程，控制权转移，可以不从函数开始处执行。

指令执行，需要在寄存器与主存间同步数据。
主存的值，须加载到寄存器。\hl{CPU指令能直接访问主存内容吗？}

物理内存大小固定，需要虚拟化，供多个进程使用。进程的地址空间彼此隔离。
由页表和TLB执行逻辑地址到物理地址的映射。
\hl{物理地址如何管理？分配和回收是否需要free list或bitmap一样的索引结构？}

Hugepage可以减小页表的大小，加快检索性能。

进程空间分用户空间和kernel空间。用户进程空间分段管理：text，data，bss，heap，stack。

进程-进程空间-内存-I/O是核心概念，是理解的主要节点。物理内存不足时，可以借用部分磁盘swap空间，
但这种情况会引起频繁的swap in/out，造成性能抖动。

程序的执行过程：汇编、链接、加载。加载后生成一进程，参与调度。
