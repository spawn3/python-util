\chapter{数据库系统}

从操作系统开始到数据库管理系统，对并发现象的讨论，上升到新的高度。
硬件提供了基础原子指令，利用这些原子指令封装成并发原语，
进一步去实现事物的ACID要求。

计算模型：事务的页模型和对象模型。对象模型是页模型的一个推广，对象模型的叶子节点是页，构成一棵树。

没有什么比好的理论更有用。透过页模型可以推演出很多重要结论。
并发控制算法、事务恢复、分布式提交是由简单到复杂的推演路径。
前两个可以在单节点环境下讨论，然后提升到分布式环境下，引出分布式提交的概念。

答案并非唯一，多种答案之间权衡利弊得失。

\section{并发问题}

并发访问共享对象，竞态条件

\begin{enumbox}
\item 过程是否发生了yield，不连续执行？
\item 临界区有哪些共享对象？
\item 冲突操作
\item 如果有多个并发任务重入该过程，会造成什么问题？
\item 加锁的粒度如何，太大，或太小？
\item 乱序？
\item 有无lock free，wait free方案？
\end{enumbox}

\section{事务管理}

事务模型、详解ACID。

\subsection{隔离等级}

\section{可串行化理论}

单站点的可串行化，单副本可串行化（RSM）

冲突操作：优先图的节点是事务，节点之间的边是冲突操作对。无环时是可串行调度。

\section{2PL}

2PL可以保障事务串行化。注意加锁的顺序和解锁的顺序。

索引结构上的加锁规则

lock-free queue：并非无锁，而是小锁。

\section{并发设计模式}

意向锁？

范围锁？

\begin{compactitem}
    \item double check
    \item fork and join
    \item pipeline
    \item half sync, half async
\end{compactitem}

\section{故障恢复}

基于日志的恢复

REDO

UNDO
