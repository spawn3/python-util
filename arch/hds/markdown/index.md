% LICH存储系统待实现功能
%
% 2016.08.16

-----

# 项目计划

物理资源：

- 引入保护域（存储池）

逻辑资源：

- 引入多租户（资源池，卷隶属于租户）

高级功能：

- QoS SPEC
- 一致性卷组
- 自动快照策略
- 异步远程复制

ISCSI：

- linux iscsi client限制
- 访问策略（chap认证）
- 主机映射关系管理

OpenStack：

- cinder driver

SA:

- 配置管理 （导出/导入）
- 操作日志
- 统计报表
- 许可管理
- 版本升级
- 性能管理
- 事件/告警/通知

## 问题

创建/删除租户

租户只能看到自己所拥有的资源。如何进行数据访问控制？CHAP？

主机映射关系的实现可能有问题？

list pool的扩展性问题

QoS:

- Pool
- Volume
- Host Mapping


# 功能

## 块服务

### 物理资源

- 节点
- 磁盘（分级, 缓存）
- 保护域
- 存储池
- 故障域

保护域是对集群的所有节点进行物理划分，一个节点只能属于一个存储池。
一个卷的所有数据只能属于一个保护域，保护域起到物理隔离的目的。

存储池进一步对保护域进行物理划分，限定了资源的数据范围和故障边界。

故障域：一个数据块的每一个副本，存放在不同的故障域里。即便某一个故障域发生了整体故障，
也不会影响到别的副本，保障了数据安全。一个保护域或存储池内，必须有足够的故障域，才能
保证数据块的所有副本，都能分配到存储位置。

对每个节点上的存储介质，包括SSD和HDD，可以分成多级进行组织，也可以拿出部分高速存储介质，
作为缓存层，提升系统的整体性能。

需要支持把资源池或卷绑定到特定的介质层上，如高IOPS，高吞吐量，大容量。

### 逻辑资源

- pool
- volume
- snapshot

pool是一逻辑实体，类似于文件夹或容器，具有如下特征：

- 当前的实现，pool可以嵌套
- pool可以指定副本策略，并具有继承关系
- pool无法指定容量
- pool可以指定保护域？
- pool可以指定介质层？
- QoS?


属性      描述  值范围
--------- ----- ----------
名字
创建时间
副本策略
容量上限
卷数上限?
IOPS
BW
Latency
--------- ----- ----------

volume是核心对象，有元数据和数据，具有如下特征：

- 隶属于pool，以pool为父
- volume可以指定副本策略，并具有继承关系
- volume有大小，并可以动态调整大小 
- volume可以生成快照，也可以从快照clone出volume（可写快照）
- 支持精简配置
- 支持tiering
- QoS?

snapshot隶属于volume，是一种特殊的volume，具有如下特征：

- 以所在volume为父
- 只读
- rollback
- clone出卷
- 一个卷上的snapshot有上限
- 当前实现是线性的，不是树状的
- 创建snapshot极快，毫秒级

资源对象上可以设定扩展属性。

### 多租户

多租户模式：支持服务质量QoS控制，提供针对某个特定用户卷的带宽与IOPS的限速机制。
同时还支持不同保护域的划分。

数据消费层的一个重要组成部分是展现给用户/租户的门户（portal），也就是每个用户的管理平台（GUI/CLI）。
这是一个专属的环境，可以由每个用户自己动态定制，它的功能包括但不限于：
部署，监控，事件/警报管理，资源的使用，报表生成，流程管理等。
此外用户也可以在专属门户内定制所需的数据服务。

在创建租户时，可以指定一个或多个保护域，也可以不指定，在系统范围内分配存储空间。

用户可以创建资源池和逻辑卷，资源池和逻辑卷要能够绑定到特定保护域内。
不绑定的时候，系统在用户可达的保护域内自动分配存储空间。

卷的访问控制规则：默认情况下

### QoS

### 数据迁移和复制

在不同保护域内迁移或复制卷

复制关系（源卷，目标卷，策略，其它属性）CRUD

## 主机系统

linux下iscsi客户端的局限，导致无法实现系统最大卷数100000。

iscsi chap鉴权

主机映射关系


## 系统管理UMP

项目描述：

分布式存储系统管理，包括两部分：web UI和CLI。

主要功能模块列表：

- 基于角色的用户管理
- 物理资源管理（集群，保护域，故障域，节点，磁盘等）
- 逻辑资源管理（存储池，卷，快照，主机映射等）
- 配置管理（导出/导入）
- 监控
- 仪表盘
- 日志
- 事件
- 告警
- 统计报表
- 许可管理
- 版本管理
- 性能管理

监控项，触发器，事件，告警


## 对接云平台

openstack cinder


# 问题


资源的owner是谁？访问控制策略是什么？

如果一个pool里有很多volume，如何列出？

多租户模式

远程复制

一致性组

# 其它

Resource   C   R   U   D
--------- --- --- --- ---
Pool
Volume
Snapshot
--------- --- --- --- ---

## 生命周期模型

在删除特定资源后，要回收资源所占资源。

属性：结构属性，策略属性和行为属性

## 存储池

属性：

- 创建时间
- 副本策略
- 卷数上限
- 容量上限
- IOPS/BW/Latency

操作：

- CRUD
- 扩展/缩小


## 逻辑卷

属性：

- 创建时间
- Pool
- 副本策略
- IOPS/BW/Latency

支持功能：

- 创建/初始化/卸载/删除/扩展
- 修改卷所在的池
- 查询卷的IOPS/BW/Latency
- QoS (IOPS)

## 快照

- 基于快照生成快照(clone)
- 回收快照空间

## 多主机映射

- 创建映射关系
- 删除映射关系
- 强制解除映射关系，中止连接
- 在卸载卷时，删除映射关系？


compression
de-duplication
multi-tenancy

- cli如何访问数据库？
- 相关信息附于attr？

## 数据恢复

